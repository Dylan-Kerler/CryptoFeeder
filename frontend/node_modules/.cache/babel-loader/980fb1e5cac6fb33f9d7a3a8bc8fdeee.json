{"ast":null,"code":"import _slicedToArray from \"/home/levi/Desktop/WebProjects/CryptoFeeder/frontend/dev/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/levi/Desktop/WebProjects/CryptoFeeder/frontend/dev/src/ReactComponents/DataDisplay/DataDisplay.js\";\nimport React, { useEffect, useReducer, useContext, useState, createContext } from \"react\";\nimport socket from \"../Socket\";\nimport settingsStore from \"../Store/Settings\";\nimport priceStore from \"../Store/Price\";\n\nconst anomaliesReducer = (state, action) => {\n  state[action.type].push(...action.data);\n  const LIMIT = 500;\n\n  if (state[action.type].length > LIMIT) {\n    state[action.type].shift();\n  } // Do a deep copy here, so that on next comparison, react knows that the state has changed ({} !== {})\n\n\n  return JSON.parse(JSON.stringify(state));\n};\n\nconst AnomaliesContext = createContext();\nconst TimeContext = createContext(Date.now());\nconst SettingsContext = createContext(settingsStore.getState());\nconst PriceContext = createContext(priceStore.getState()[\"BTCUSDT\"]);\n\nconst DataDisplay = () => {\n  const initialState = {\n    \"volume\": [],\n    \"price\": [],\n    \"liquidity\": []\n  };\n\n  const _useReducer = useReducer(anomaliesReducer, initialState),\n        _useReducer2 = _slicedToArray(_useReducer, 2),\n        anomalies = _useReducer2[0],\n        dispatchAnomalies = _useReducer2[1];\n\n  const _useState = useState(Date.now()),\n        _useState2 = _slicedToArray(_useState, 2),\n        now = _useState2[0],\n        setNow = _useState2[1];\n\n  const _useState3 = useState(settingsStore.getState()),\n        _useState4 = _slicedToArray(_useState3, 2),\n        settings = _useState4[0],\n        setSettings = _useState4[1];\n\n  const _useState5 = useState(priceStore.getState()[\"BTCUSDT\"]),\n        _useState6 = _slicedToArray(_useState5, 2),\n        price = _useState6[0],\n        setPrice = _useState6[1];\n\n  const dataTypes = [\"volume\", \"price\", \"liquidity\"]; // Initialise the anomalies\n\n  useEffect(() => {\n    //Hit the cache api and set the initial state\n    fetch(\"http://localhost:8080/api/little_cache\").then(res => res.json().then(recentEventCache => {\n      Object.keys(recentEventCache).forEach(key => {\n        if (dataTypes.includes(key)) {\n          dispatchAnomalies({\n            type: key,\n            data: recentEventCache[key]\n          });\n        }\n      });\n    })); //Subscribe to anomalies to push to anomalies state\n\n    socket.on(\"NEW_ANOMALY\", anomaly => {\n      dispatchAnomalies({\n        type: anomaly.group,\n        data: [anomaly]\n      });\n    });\n  }, []); // Subscribe to stores\n\n  useEffect(() => {\n    const settingStoreUnsubscribe = settingsStore.subscribe(() => {\n      setSettings(settingsStore.getState());\n    });\n    const priceStoreUnsubscribe = priceStore.subscribe(() => {\n      setPrice(priceStore.getState()[\"BTCUSDT\"]);\n    });\n    return () => {\n      settingStoreUnsubscribe();\n      priceStoreUnsubscribe();\n    };\n  }, []); // Start setNow interval\n\n  useEffect(() => {\n    const threadId = setInterval(() => {\n      setNow(Date.now());\n    }, 1000);\n    return () => clearInterval(threadId);\n  }, []);\n  const dataDivs = dataTypes.map((type, index) => React.createElement(DataDiv, {\n    dataType: type,\n    key: index,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77\n    },\n    __self: this\n  }));\n  return React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79\n    },\n    __self: this\n  }, React.createElement(SettingsContext.Provider, {\n    value: settings,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80\n    },\n    __self: this\n  }, React.createElement(PriceContext.Provider, {\n    value: price,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81\n    },\n    __self: this\n  }, React.createElement(TimeContext.Provider, {\n    value: now,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  }, React.createElement(AnomaliesContext.Provider, {\n    value: anomalies,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }, dataDivs)))));\n};\n\nconst DataDiv = props => {\n  const anomalies = useContext(AnomaliesContext);\n  const dataType = props.dataType; // Loop through all anomalies of that type and parse the anomaly into text\n\n  const relevantAnomalies = anomalies[props.dataType].map((anomaly, index) => {\n    return React.createElement(ParsedText, {\n      dataType: dataType,\n      anomaly: anomaly,\n      key: index,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100\n      },\n      __self: this\n    });\n  });\n  return React.createElement(\"div\", {\n    id: `${dataType}_data_div`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, React.createElement(\"h1\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, `${dataType.slice(0, 1).toUpperCase()}${dataType.slice(1)}`), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, //Anomalies are organised with oldest -> newest (needs to be reversed)\n  relevantAnomalies.reverse()));\n};\n\nconst ParsedText = ({\n  anomaly,\n  dataType\n}) => {\n  let element = \"\";\n  const settings = useContext(SettingsContext);\n  const NOW = useContext(TimeContext);\n  const timePassed = NOW - anomaly.data.timestamp * 1000;\n  const movingTimeString = timePassed > 120 * 1000 ? timePassed > 60 * 1000 * 60 ? \"\" : \"(\" + Math.floor(timePassed / 1000 / 60) + \" minutes ago)\" : \"(\" + Math.floor(timePassed / 1000) + \" seconds ago)\";\n  const anomalyTimeRange = anomaly.data.timestamp * 1000 - anomaly.data.limitTimestamp;\n  const anomalyTimeRangeString = anomalyTimeRange > 120 * 1000 ? Math.floor(anomalyTimeRange / 1000 / 60) + \" minutes \" : Math.floor(anomalyTimeRange / 1000) + \" seconds \";\n\n  if (anomaly.coin === settings.coin || settings.coin === \"all\") {\n    switch (anomaly.type) {\n      case \"volumeAnomaly\":\n        if (anomaly.data.total >= settings.minVolume) {\n          element = React.createElement(\"p\", {\n            className: `${dataType}_text`,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 131\n            },\n            __self: this\n          }, anomaly.data.total + \" \", \" BTC worth of \", anomaly.coin + \" \", \"was \", anomaly.data.isBuyVolume ? \"bought \" : \"sold \", \" on \", anomaly.exchange + \" \", \"in the past \", anomalyTimeRangeString, \" -\", \" \" + ((anomaly.data.total / anomaly.data.hourlyMa200 - 1) * 100).toFixed(2) + \"% \", \" higher than the 200 hourly average.\", movingTimeString);\n        }\n\n        break;\n\n      case \"anomalyPriceRange\":\n        if (anomaly.data.change * 100 >= settings.minPriceIncrease) {\n          element = React.createElement(\"p\", {\n            className: `${dataType}_text`,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 142\n            },\n            __self: this\n          }, anomaly.coin, \" just \", anomaly.data.positive ? \"pumped \" : \"dumped \", (anomaly.data.change * 100).toFixed(2), \"% in the past \", anomalyTimeRangeString, \" -\", \" \" + ((anomaly.data.range / anomaly.data.maRange - 1) * 100).toFixed(2) + \"%\", \" higher than the 200 hourly average\", \" \" + movingTimeString);\n        }\n\n        break;\n\n      case \"OrderBookIncrease\":\n        //console.log(settings.minOrderSize)\n        if (anomaly.data.total >= settings.minOrderSize) {\n          element = React.createElement(\"p\", {\n            className: `${dataType}_text`,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 155\n            },\n            __self: this\n          }, \"$\", anomaly.data.total, \" \", anomaly.data.isBuySide ? \"buy \" : \"sell\", \" wall for \", anomaly.coin + \" \", \"appeared \", movingTimeString, \" on \", anomaly.exchange, \" - A \", ((anomaly.data.buySide / anomaly.data.maTotal - 1) * 100).toFixed(2), \"% increase from the 200 hourly average\");\n        }\n\n        break;\n    }\n  }\n\n  return (() => element ? React.createElement(\"div\", {\n    id: `${dataType}_data_1`,\n    className: `data_box ${dataType}_box`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }, element, React.createElement(\"p\", {\n    className: \"data_timestamp\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }, new Date(anomaly.data.timestamp * 1000).toGMTString())) : React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }))();\n};\n\nexport default DataDisplay;","map":{"version":3,"sources":["/home/levi/Desktop/WebProjects/CryptoFeeder/frontend/dev/src/ReactComponents/DataDisplay/DataDisplay.js"],"names":["React","useEffect","useReducer","useContext","useState","createContext","socket","settingsStore","priceStore","anomaliesReducer","state","action","type","push","data","LIMIT","length","shift","JSON","parse","stringify","AnomaliesContext","TimeContext","Date","now","SettingsContext","getState","PriceContext","DataDisplay","initialState","anomalies","dispatchAnomalies","setNow","settings","setSettings","price","setPrice","dataTypes","fetch","then","res","json","recentEventCache","Object","keys","forEach","key","includes","on","anomaly","group","settingStoreUnsubscribe","subscribe","priceStoreUnsubscribe","threadId","setInterval","clearInterval","dataDivs","map","index","DataDiv","props","dataType","relevantAnomalies","slice","toUpperCase","reverse","ParsedText","element","NOW","timePassed","timestamp","movingTimeString","Math","floor","anomalyTimeRange","limitTimestamp","anomalyTimeRangeString","coin","total","minVolume","isBuyVolume","exchange","hourlyMa200","toFixed","change","minPriceIncrease","positive","range","maRange","minOrderSize","isBuySide","buySide","maTotal","toGMTString"],"mappings":"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","sourcesContent":["import React, {useEffect, useReducer, useContext, useState, createContext} from \"react\";\nimport socket from \"../Socket\";\nimport settingsStore from \"../Store/Settings\";\nimport priceStore from \"../Store/Price\";\n\nconst anomaliesReducer = (state, action) => {\n    state[action.type].push(...action.data);\n    const LIMIT = 500;\n    if (state[action.type].length > LIMIT) {\n        state[action.type].shift();\n    }\n\n    // Do a deep copy here, so that on next comparison, react knows that the state has changed ({} !== {})\n    return JSON.parse(JSON.stringify(state));\n};\n\nconst AnomaliesContext = createContext();\nconst TimeContext = createContext(Date.now());\nconst SettingsContext = createContext(settingsStore.getState());\nconst PriceContext = createContext(priceStore.getState()[\"BTCUSDT\"]);\n\nconst DataDisplay = () => {\n    const initialState = {\n        \"volume\":       [],\n        \"price\":        [],\n        \"liquidity\":    [],\n    };\n\n    const [anomalies, dispatchAnomalies] = useReducer(anomaliesReducer, initialState);\n    const [now, setNow] = useState(Date.now());\n    const [settings, setSettings] = useState(settingsStore.getState());\n    const [price, setPrice] = useState(priceStore.getState()[\"BTCUSDT\"]);\n    const dataTypes = [\"volume\", \"price\", \"liquidity\"];\n\n    // Initialise the anomalies\n    useEffect(() => {\n        //Hit the cache api and set the initial state\n        fetch(\"http://localhost:8080/api/little_cache\").then(res => res.json().then(recentEventCache => {\n            Object.keys(recentEventCache).forEach(key => {\n                if (dataTypes.includes(key)) {\n                    dispatchAnomalies({type: key, data: recentEventCache[key]});\n                }\n            })\n        }));\n\n        //Subscribe to anomalies to push to anomalies state\n        socket.on(\"NEW_ANOMALY\", (anomaly) => {\n            dispatchAnomalies({type: anomaly.group, data: [anomaly]});\n        });\n    }, []);\n\n    // Subscribe to stores\n    useEffect(() => {\n        const settingStoreUnsubscribe = settingsStore.subscribe(() => {\n            setSettings(settingsStore.getState());\n        });\n\n        const priceStoreUnsubscribe = priceStore.subscribe(() => {\n            setPrice(priceStore.getState()[\"BTCUSDT\"]);\n        });\n\n        return () => {\n            settingStoreUnsubscribe();\n            priceStoreUnsubscribe();\n        }\n    }, []);\n\n    // Start setNow interval\n    useEffect(() => {\n        const threadId = setInterval(() => {\n            setNow(Date.now());\n        }, 1000);\n\n        return () => clearInterval(threadId);\n    }, []);\n\n    const dataDivs = dataTypes.map((type, index) => <DataDiv dataType={type} key={index}/>);\n    return (\n        <React.Fragment>\n            <SettingsContext.Provider value={settings}>\n                <PriceContext.Provider value={price}>\n                    <TimeContext.Provider value={now}>\n                        <AnomaliesContext.Provider value={anomalies}>\n                            {dataDivs}\n                        </AnomaliesContext.Provider>\n                    </TimeContext.Provider>\n                </PriceContext.Provider>\n            </SettingsContext.Provider>\n        </React.Fragment>\n    );\n};\n\nconst DataDiv = (props) => {\n    const anomalies = useContext(AnomaliesContext);\n    const dataType = props.dataType;\n\n    // Loop through all anomalies of that type and parse the anomaly into text\n    const relevantAnomalies = anomalies[props.dataType].map((anomaly, index) => {\n        return (\n            <ParsedText dataType={dataType} anomaly={anomaly} key={index}/>\n        );\n    });\n\n    return (\n        <div id={`${dataType}_data_div`}>\n            <h1>{`${dataType.slice(0,1).toUpperCase()}${dataType.slice(1)}`}</h1>\n            <div>\n                { //Anomalies are organised with oldest -> newest (needs to be reversed)\n                  relevantAnomalies.reverse() }\n            </div>\n        </div>\n    )\n};\n\nconst ParsedText = ({anomaly, dataType}) => {\n    let element = \"\";\n    const settings = useContext(SettingsContext);\n    const NOW = useContext(TimeContext);\n    const timePassed = NOW - anomaly.data.timestamp * 1000;\n    const movingTimeString = timePassed > 120 * 1000 ? timePassed > 60 * 1000 * 60 ? \"\"\n                                                    : \"(\" + Math.floor(timePassed / 1000 / 60) + \" minutes ago)\"\n                                                    : \"(\" + Math.floor(timePassed / 1000) + \" seconds ago)\";\n\n    const anomalyTimeRange = anomaly.data.timestamp * 1000 - anomaly.data.limitTimestamp;\n    const anomalyTimeRangeString = anomalyTimeRange > 120 * 1000 ? Math.floor(anomalyTimeRange / 1000 / 60) + \" minutes \" : Math.floor(anomalyTimeRange / 1000) + \" seconds \";\n\n    if (anomaly.coin === settings.coin || settings.coin === \"all\") {\n        switch (anomaly.type) {\n            case \"volumeAnomaly\":\n                if (anomaly.data.total >= settings.minVolume) {\n                    element = <p className={`${dataType}_text`}>\n                        {anomaly.data.total + \" \"} BTC worth of {anomaly.coin + \" \"}\n                        was {anomaly.data.isBuyVolume ? \"bought \" : \"sold \"} on {anomaly.exchange + \" \"}\n                        in the past {anomalyTimeRangeString} -\n                        {\" \" + ((anomaly.data.total / anomaly.data.hourlyMa200 - 1) * 100).toFixed(2) + \"% \"} higher than the 200 hourly average.\n                        {movingTimeString}\n                    </p>;\n                }\n                break;\n            case \"anomalyPriceRange\":\n                if (anomaly.data.change * 100 >= settings.minPriceIncrease) {\n                    element = <p className={`${dataType}_text`}>\n                        {anomaly.coin} just {anomaly.data.positive ? \"pumped \" : \"dumped \"}\n                        {(anomaly.data.change * 100).toFixed(2)}%\n                        in the past {anomalyTimeRangeString} -\n                        {\" \" + ((anomaly.data.range / anomaly.data.maRange - 1) * 100).toFixed(2) + \"%\"} higher than the 200 hourly average\n                        {\" \" + movingTimeString}\n                    </p>\n                }\n                break;\n\n            case \"OrderBookIncrease\":\n                //console.log(settings.minOrderSize)\n                if (anomaly.data.total >= settings.minOrderSize) {\n                    element = <p className={`${dataType}_text`}>\n                        ${anomaly.data.total} {anomaly.data.isBuySide ? \"buy \" : \"sell\"} wall for {anomaly.coin + \" \"}\n                        appeared {movingTimeString} on {anomaly.exchange} - A {((anomaly.data.buySide / anomaly.data.maTotal - 1) * 100).toFixed(2)}% increase\n                        from the 200 hourly average\n                    </p>\n                }\n                break;\n        }\n    }\n\n    return (\n        (() =>\n            element ?\n                    <div id={`${dataType}_data_1`} className={`data_box ${dataType}_box`}>\n                        {element}\n                        <p className=\"data_timestamp\">{new Date(anomaly.data.timestamp * 1000).toGMTString()}</p>\n                    </div>\n                :\n                    <React.Fragment/>\n        )()\n    );\n};\n\nexport default DataDisplay;\n"]},"metadata":{},"sourceType":"module"}
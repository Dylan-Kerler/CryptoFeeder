{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.keepStreamAlive = exports.userEventHandler = void 0;\n\nvar _lodash = _interopRequireDefault(require(\"lodash.zipobject\"));\n\nvar _httpClient = _interopRequireDefault(require(\"./http-client\"));\n\nvar _openWebsocket = _interopRequireDefault(require(\"./open-websocket\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar BASE = 'wss://stream.binance.com:9443/ws';\n\nvar depth = function depth(payload, cb) {\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (symbol) {\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@depth\"));\n\n    w.onmessage = function (msg) {\n      var _JSON$parse = JSON.parse(msg.data),\n          eventType = _JSON$parse.e,\n          eventTime = _JSON$parse.E,\n          symbol = _JSON$parse.s,\n          firstUpdateId = _JSON$parse.U,\n          finalUpdateId = _JSON$parse.u,\n          bidDepth = _JSON$parse.b,\n          askDepth = _JSON$parse.a;\n\n      cb({\n        eventType: eventType,\n        eventTime: eventTime,\n        symbol: symbol,\n        firstUpdateId: firstUpdateId,\n        finalUpdateId: finalUpdateId,\n        bidDepth: bidDepth.map(function (b) {\n          return (0, _lodash.default)(['price', 'quantity'], b);\n        }),\n        askDepth: askDepth.map(function (a) {\n          return (0, _lodash.default)(['price', 'quantity'], a);\n        })\n      });\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar partialDepth = function partialDepth(payload, cb) {\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (_ref) {\n    var symbol = _ref.symbol,\n        level = _ref.level;\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@depth\").concat(level));\n\n    w.onmessage = function (msg) {\n      var _JSON$parse2 = JSON.parse(msg.data),\n          lastUpdateId = _JSON$parse2.lastUpdateId,\n          bids = _JSON$parse2.bids,\n          asks = _JSON$parse2.asks;\n\n      cb({\n        symbol: symbol,\n        level: level,\n        lastUpdateId: lastUpdateId,\n        bids: bids.map(function (b) {\n          return (0, _lodash.default)(['price', 'quantity'], b);\n        }),\n        asks: asks.map(function (a) {\n          return (0, _lodash.default)(['price', 'quantity'], a);\n        })\n      });\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar candles = function candles(payload, interval, cb) {\n  if (!interval || !cb) {\n    throw new Error('Please pass a symbol, interval and callback.');\n  }\n\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (symbol) {\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@kline_\").concat(interval));\n\n    w.onmessage = function (msg) {\n      var _JSON$parse3 = JSON.parse(msg.data),\n          eventType = _JSON$parse3.e,\n          eventTime = _JSON$parse3.E,\n          symbol = _JSON$parse3.s,\n          tick = _JSON$parse3.k;\n\n      var startTime = tick.t,\n          closeTime = tick.T,\n          firstTradeId = tick.f,\n          lastTradeId = tick.L,\n          open = tick.o,\n          high = tick.h,\n          low = tick.l,\n          close = tick.c,\n          volume = tick.v,\n          trades = tick.n,\n          interval = tick.i,\n          isFinal = tick.x,\n          quoteVolume = tick.q,\n          buyVolume = tick.V,\n          quoteBuyVolume = tick.Q;\n      cb({\n        eventType: eventType,\n        eventTime: eventTime,\n        symbol: symbol,\n        startTime: startTime,\n        closeTime: closeTime,\n        firstTradeId: firstTradeId,\n        lastTradeId: lastTradeId,\n        open: open,\n        high: high,\n        low: low,\n        close: close,\n        volume: volume,\n        trades: trades,\n        interval: interval,\n        isFinal: isFinal,\n        quoteVolume: quoteVolume,\n        buyVolume: buyVolume,\n        quoteBuyVolume: quoteBuyVolume\n      });\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar tickerTransform = function tickerTransform(m) {\n  return {\n    eventType: m.e,\n    eventTime: m.E,\n    symbol: m.s,\n    priceChange: m.p,\n    priceChangePercent: m.P,\n    weightedAvg: m.w,\n    prevDayClose: m.x,\n    curDayClose: m.c,\n    closeTradeQuantity: m.Q,\n    bestBid: m.b,\n    bestBidQnt: m.B,\n    bestAsk: m.a,\n    bestAskQnt: m.A,\n    open: m.o,\n    high: m.h,\n    low: m.l,\n    volume: m.v,\n    volumeQuote: m.q,\n    openTime: m.O,\n    closeTime: m.C,\n    firstTradeId: m.F,\n    lastTradeId: m.L,\n    totalTrades: m.n\n  };\n};\n\nvar ticker = function ticker(payload, cb) {\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (symbol) {\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@ticker\"));\n\n    w.onmessage = function (msg) {\n      cb(tickerTransform(JSON.parse(msg.data)));\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar allTickers = function allTickers(cb) {\n  var w = new _openWebsocket.default(\"\".concat(BASE, \"/!ticker@arr\"));\n\n  w.onmessage = function (msg) {\n    var arr = JSON.parse(msg.data);\n    cb(arr.map(function (m) {\n      return tickerTransform(m);\n    }));\n  };\n\n  return function (options) {\n    return w.close(1000, 'Close handle was called', _objectSpread({\n      keepClosed: true\n    }, options));\n  };\n};\n\nvar tradesInternal = function tradesInternal(payload, streamName, cb) {\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (symbol) {\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@\").concat(streamName));\n\n    w.onmessage = function (msg) {\n      var _JSON$parse4 = JSON.parse(msg.data),\n          eventType = _JSON$parse4.e,\n          eventTime = _JSON$parse4.E,\n          symbol = _JSON$parse4.s,\n          price = _JSON$parse4.p,\n          quantity = _JSON$parse4.q,\n          maker = _JSON$parse4.m,\n          isBuyerMaker = _JSON$parse4.M,\n          tradeId = _JSON$parse4.a;\n\n      cb({\n        eventType: eventType,\n        eventTime: eventTime,\n        symbol: symbol,\n        price: price,\n        quantity: quantity,\n        maker: maker,\n        isBuyerMaker: isBuyerMaker,\n        tradeId: tradeId\n      });\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar aggTrades = function aggTrades(payload, cb) {\n  return tradesInternal(payload, 'aggTrade', cb);\n};\n\nvar trades = function trades(payload, cb) {\n  return tradesInternal(payload, 'trade', cb);\n};\n\nvar userTransforms = {\n  outboundAccountInfo: function outboundAccountInfo(m) {\n    return {\n      eventType: 'account',\n      eventTime: m.E,\n      makerCommissionRate: m.m,\n      takerCommissionRate: m.t,\n      buyerCommissionRate: m.b,\n      sellerCommissionRate: m.s,\n      canTrade: m.T,\n      canWithdraw: m.W,\n      canDeposit: m.D,\n      lastAccountUpdate: m.u,\n      balances: m.B.reduce(function (out, cur) {\n        out[cur.a] = {\n          available: cur.f,\n          locked: cur.l\n        };\n        return out;\n      }, {})\n    };\n  },\n  executionReport: function executionReport(m) {\n    return {\n      eventType: 'executionReport',\n      eventTime: m.E,\n      symbol: m.s,\n      newClientOrderId: m.c,\n      originalClientOrderId: m.C,\n      side: m.S,\n      orderType: m.o,\n      timeInForce: m.f,\n      quantity: m.q,\n      price: m.p,\n      executionType: m.x,\n      stopPrice: m.P,\n      icebergQuantity: m.F,\n      orderStatus: m.X,\n      orderRejectReason: m.r,\n      orderId: m.i,\n      orderTime: m.T,\n      lastTradeQuantity: m.l,\n      totalTradeQuantity: m.z,\n      priceLastTrade: m.L,\n      commission: m.n,\n      commissionAsset: m.N,\n      tradeId: m.t,\n      isOrderWorking: m.w,\n      isBuyerMaker: m.m,\n      creationTime: m.O,\n      totalQuoteTradeQuantity: m.Z\n    };\n  }\n};\n\nvar userEventHandler = function userEventHandler(cb) {\n  return function (msg) {\n    var _JSON$parse5 = JSON.parse(msg.data),\n        type = _JSON$parse5.e,\n        rest = _objectWithoutProperties(_JSON$parse5, [\"e\"]);\n\n    cb(userTransforms[type] ? userTransforms[type](rest) : _objectSpread({\n      type: type\n    }, rest));\n  };\n};\n\nexports.userEventHandler = userEventHandler;\n\nvar keepStreamAlive = function keepStreamAlive(method, listenKey) {\n  return method({\n    listenKey: listenKey\n  });\n};\n\nexports.keepStreamAlive = keepStreamAlive;\n\nvar user = function user(opts, margin) {\n  return function (cb) {\n    var methods = (0, _httpClient.default)(opts);\n    var getDataStream = margin ? methods.marginGetDataStream : methods.getDataStream;\n    var keepDataStream = margin ? methods.marginKeepDataStream : methods.keepDataStream;\n    var closeDataStream = margin ? methods.marginCloseDataStream : methods.closeDataStream;\n    var currentListenKey = null;\n    var int = null;\n    var w = null;\n\n    var keepAlive = function keepAlive(isReconnecting) {\n      if (currentListenKey) {\n        keepStreamAlive(keepDataStream, currentListenKey).catch(function () {\n          closeStream({}, true);\n\n          if (isReconnecting) {\n            setTimeout(function () {\n              return makeStream(true);\n            }, 30e3);\n          } else {\n            makeStream(true);\n          }\n        });\n      }\n    };\n\n    var closeStream = function closeStream(options, catchErrors) {\n      if (currentListenKey) {\n        clearInterval(int);\n        var p = closeDataStream({\n          listenKey: currentListenKey\n        });\n\n        if (catchErrors) {\n          p.catch(function (f) {\n            return f;\n          });\n        }\n\n        w.close(1000, 'Close handle was called', _objectSpread({\n          keepClosed: true\n        }, options));\n        currentListenKey = null;\n      }\n    };\n\n    var makeStream = function makeStream(isReconnecting) {\n      return getDataStream().then(function (_ref2) {\n        var listenKey = _ref2.listenKey;\n        w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(listenKey));\n\n        w.onmessage = function (msg) {\n          return userEventHandler(cb)(msg);\n        };\n\n        currentListenKey = listenKey;\n        int = setInterval(function () {\n          return keepAlive(false);\n        }, 50e3);\n        keepAlive(true);\n        return function (options) {\n          return closeStream(options);\n        };\n      }).catch(function (err) {\n        if (isReconnecting) {\n          setTimeout(function () {\n            return makeStream(true);\n          }, 30e3);\n        } else {\n          throw err;\n        }\n      });\n    };\n\n    return makeStream(false);\n  };\n};\n\nvar _default = function _default(opts) {\n  return {\n    depth: depth,\n    partialDepth: partialDepth,\n    candles: candles,\n    trades: trades,\n    aggTrades: aggTrades,\n    ticker: ticker,\n    allTickers: allTickers,\n    user: user(opts),\n    marginUser: user(opts, true)\n  };\n};\n\nexports.default = _default;","map":{"version":3,"sources":["/home/levi/Desktop/WebProjects/CryptoFeeder/node_modules/binance-api-node/dist/websocket.js"],"names":["Object","defineProperty","exports","value","default","keepStreamAlive","userEventHandler","_lodash","_interopRequireDefault","require","_httpClient","_openWebsocket","obj","__esModule","_objectWithoutProperties","source","excluded","target","_objectWithoutPropertiesLoose","key","i","getOwnPropertySymbols","sourceSymbolKeys","length","indexOf","prototype","propertyIsEnumerable","call","sourceKeys","keys","ownKeys","object","enumerableOnly","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","configurable","writable","BASE","depth","payload","cb","cache","Array","isArray","map","symbol","w","concat","toLowerCase","onmessage","msg","_JSON$parse","JSON","parse","data","eventType","e","eventTime","E","s","firstUpdateId","U","finalUpdateId","u","bidDepth","b","askDepth","a","options","close","keepClosed","partialDepth","_ref","level","_JSON$parse2","lastUpdateId","bids","asks","candles","interval","Error","_JSON$parse3","tick","k","startTime","t","closeTime","T","firstTradeId","f","lastTradeId","L","open","o","high","h","low","l","c","volume","v","trades","n","isFinal","x","quoteVolume","q","buyVolume","V","quoteBuyVolume","Q","tickerTransform","m","priceChange","p","priceChangePercent","P","weightedAvg","prevDayClose","curDayClose","closeTradeQuantity","bestBid","bestBidQnt","B","bestAsk","bestAskQnt","A","volumeQuote","openTime","O","C","F","totalTrades","ticker","allTickers","arr","tradesInternal","streamName","_JSON$parse4","price","quantity","maker","isBuyerMaker","M","tradeId","aggTrades","userTransforms","outboundAccountInfo","makerCommissionRate","takerCommissionRate","buyerCommissionRate","sellerCommissionRate","canTrade","canWithdraw","W","canDeposit","D","lastAccountUpdate","balances","reduce","out","cur","available","locked","executionReport","newClientOrderId","originalClientOrderId","side","S","orderType","timeInForce","executionType","stopPrice","icebergQuantity","orderStatus","X","orderRejectReason","r","orderId","orderTime","lastTradeQuantity","totalTradeQuantity","z","priceLastTrade","commission","commissionAsset","N","isOrderWorking","creationTime","totalQuoteTradeQuantity","Z","_JSON$parse5","type","rest","method","listenKey","user","opts","margin","methods","getDataStream","marginGetDataStream","keepDataStream","marginKeepDataStream","closeDataStream","marginCloseDataStream","currentListenKey","int","keepAlive","isReconnecting","catch","closeStream","setTimeout","makeStream","catchErrors","clearInterval","then","_ref2","setInterval","err","_default","marginUser"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,OAAR,GAAkBF,OAAO,CAACG,eAAR,GAA0BH,OAAO,CAACI,gBAAR,GAA2B,KAAK,CAA5E;;AAEA,IAAIC,OAAO,GAAGC,sBAAsB,CAACC,OAAO,CAAC,kBAAD,CAAR,CAApC;;AAEA,IAAIC,WAAW,GAAGF,sBAAsB,CAACC,OAAO,CAAC,eAAD,CAAR,CAAxC;;AAEA,IAAIE,cAAc,GAAGH,sBAAsB,CAACC,OAAO,CAAC,kBAAD,CAAR,CAA3C;;AAEA,SAASD,sBAAT,CAAgCI,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAER,IAAAA,OAAO,EAAEQ;AAAX,GAArC;AAAwD;;AAE/F,SAASE,wBAAT,CAAkCC,MAAlC,EAA0CC,QAA1C,EAAoD;AAAE,MAAID,MAAM,IAAI,IAAd,EAAoB,OAAO,EAAP;;AAAW,MAAIE,MAAM,GAAGC,6BAA6B,CAACH,MAAD,EAASC,QAAT,CAA1C;;AAA8D,MAAIG,GAAJ,EAASC,CAAT;;AAAY,MAAIpB,MAAM,CAACqB,qBAAX,EAAkC;AAAE,QAAIC,gBAAgB,GAAGtB,MAAM,CAACqB,qBAAP,CAA6BN,MAA7B,CAAvB;;AAA6D,SAAKK,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGE,gBAAgB,CAACC,MAAjC,EAAyCH,CAAC,EAA1C,EAA8C;AAAED,MAAAA,GAAG,GAAGG,gBAAgB,CAACF,CAAD,CAAtB;AAA2B,UAAIJ,QAAQ,CAACQ,OAAT,CAAiBL,GAAjB,KAAyB,CAA7B,EAAgC;AAAU,UAAI,CAACnB,MAAM,CAACyB,SAAP,CAAiBC,oBAAjB,CAAsCC,IAAtC,CAA2CZ,MAA3C,EAAmDI,GAAnD,CAAL,EAA8D;AAAUF,MAAAA,MAAM,CAACE,GAAD,CAAN,GAAcJ,MAAM,CAACI,GAAD,CAApB;AAA4B;AAAE;;AAAC,SAAOF,MAAP;AAAgB;;AAE5e,SAASC,6BAAT,CAAuCH,MAAvC,EAA+CC,QAA/C,EAAyD;AAAE,MAAID,MAAM,IAAI,IAAd,EAAoB,OAAO,EAAP;AAAW,MAAIE,MAAM,GAAG,EAAb;AAAiB,MAAIW,UAAU,GAAG5B,MAAM,CAAC6B,IAAP,CAAYd,MAAZ,CAAjB;AAAsC,MAAII,GAAJ,EAASC,CAAT;;AAAY,OAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGQ,UAAU,CAACL,MAA3B,EAAmCH,CAAC,EAApC,EAAwC;AAAED,IAAAA,GAAG,GAAGS,UAAU,CAACR,CAAD,CAAhB;AAAqB,QAAIJ,QAAQ,CAACQ,OAAT,CAAiBL,GAAjB,KAAyB,CAA7B,EAAgC;AAAUF,IAAAA,MAAM,CAACE,GAAD,CAAN,GAAcJ,MAAM,CAACI,GAAD,CAApB;AAA4B;;AAAC,SAAOF,MAAP;AAAgB;;AAEnT,SAASa,OAAT,CAAiBC,MAAjB,EAAyBC,cAAzB,EAAyC;AAAE,MAAIH,IAAI,GAAG7B,MAAM,CAAC6B,IAAP,CAAYE,MAAZ,CAAX;;AAAgC,MAAI/B,MAAM,CAACqB,qBAAX,EAAkC;AAAE,QAAIY,OAAO,GAAGjC,MAAM,CAACqB,qBAAP,CAA6BU,MAA7B,CAAd;AAAoD,QAAIC,cAAJ,EAAoBC,OAAO,GAAGA,OAAO,CAACC,MAAR,CAAe,UAAUC,GAAV,EAAe;AAAE,aAAOnC,MAAM,CAACoC,wBAAP,CAAgCL,MAAhC,EAAwCI,GAAxC,EAA6CE,UAApD;AAAiE,KAAjG,CAAV;AAA8GR,IAAAA,IAAI,CAACS,IAAL,CAAUC,KAAV,CAAgBV,IAAhB,EAAsBI,OAAtB;AAAiC;;AAAC,SAAOJ,IAAP;AAAc;;AAErV,SAASW,aAAT,CAAuBvB,MAAvB,EAA+B;AAAE,OAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqB,SAAS,CAAClB,MAA9B,EAAsCH,CAAC,EAAvC,EAA2C;AAAE,QAAIL,MAAM,GAAG0B,SAAS,CAACrB,CAAD,CAAT,IAAgB,IAAhB,GAAuBqB,SAAS,CAACrB,CAAD,CAAhC,GAAsC,EAAnD;;AAAuD,QAAIA,CAAC,GAAG,CAAR,EAAW;AAAEU,MAAAA,OAAO,CAAC9B,MAAM,CAACe,MAAD,CAAP,EAAiB,IAAjB,CAAP,CAA8B2B,OAA9B,CAAsC,UAAUvB,GAAV,EAAe;AAAEwB,QAAAA,eAAe,CAAC1B,MAAD,EAASE,GAAT,EAAcJ,MAAM,CAACI,GAAD,CAApB,CAAf;AAA4C,OAAnG;AAAuG,KAApH,MAA0H,IAAInB,MAAM,CAAC4C,yBAAX,EAAsC;AAAE5C,MAAAA,MAAM,CAAC6C,gBAAP,CAAwB5B,MAAxB,EAAgCjB,MAAM,CAAC4C,yBAAP,CAAiC7B,MAAjC,CAAhC;AAA4E,KAApH,MAA0H;AAAEe,MAAAA,OAAO,CAAC9B,MAAM,CAACe,MAAD,CAAP,CAAP,CAAwB2B,OAAxB,CAAgC,UAAUvB,GAAV,EAAe;AAAEnB,QAAAA,MAAM,CAACC,cAAP,CAAsBgB,MAAtB,EAA8BE,GAA9B,EAAmCnB,MAAM,CAACoC,wBAAP,CAAgCrB,MAAhC,EAAwCI,GAAxC,CAAnC;AAAmF,OAApI;AAAwI;AAAE;;AAAC,SAAOF,MAAP;AAAgB;;AAEthB,SAAS0B,eAAT,CAAyB/B,GAAzB,EAA8BO,GAA9B,EAAmChB,KAAnC,EAA0C;AAAE,MAAIgB,GAAG,IAAIP,GAAX,EAAgB;AAAEZ,IAAAA,MAAM,CAACC,cAAP,CAAsBW,GAAtB,EAA2BO,GAA3B,EAAgC;AAAEhB,MAAAA,KAAK,EAAEA,KAAT;AAAgBkC,MAAAA,UAAU,EAAE,IAA5B;AAAkCS,MAAAA,YAAY,EAAE,IAAhD;AAAsDC,MAAAA,QAAQ,EAAE;AAAhE,KAAhC;AAA0G,GAA5H,MAAkI;AAAEnC,IAAAA,GAAG,CAACO,GAAD,CAAH,GAAWhB,KAAX;AAAmB;;AAAC,SAAOS,GAAP;AAAa;;AAEjN,IAAIoC,IAAI,GAAG,kCAAX;;AAEA,IAAIC,KAAK,GAAG,SAASA,KAAT,CAAeC,OAAf,EAAwBC,EAAxB,EAA4B;AACtC,MAAIC,KAAK,GAAG,CAACC,KAAK,CAACC,OAAN,CAAcJ,OAAd,IAAyBA,OAAzB,GAAmC,CAACA,OAAD,CAApC,EAA+CK,GAA/C,CAAmD,UAAUC,MAAV,EAAkB;AAC/E,QAAIC,CAAC,GAAG,CAAC,GAAG9C,cAAc,CAACP,OAAnB,EAA4B,GAAGsD,MAAH,CAAUV,IAAV,EAAgB,GAAhB,EAAqBU,MAArB,CAA4BF,MAAM,CAACG,WAAP,EAA5B,EAAkD,QAAlD,CAA5B,CAAR;;AAEAF,IAAAA,CAAC,CAACG,SAAF,GAAc,UAAUC,GAAV,EAAe;AAC3B,UAAIC,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,IAAf,CAAlB;AAAA,UACIC,SAAS,GAAGJ,WAAW,CAACK,CAD5B;AAAA,UAEIC,SAAS,GAAGN,WAAW,CAACO,CAF5B;AAAA,UAGIb,MAAM,GAAGM,WAAW,CAACQ,CAHzB;AAAA,UAIIC,aAAa,GAAGT,WAAW,CAACU,CAJhC;AAAA,UAKIC,aAAa,GAAGX,WAAW,CAACY,CALhC;AAAA,UAMIC,QAAQ,GAAGb,WAAW,CAACc,CAN3B;AAAA,UAOIC,QAAQ,GAAGf,WAAW,CAACgB,CAP3B;;AASA3B,MAAAA,EAAE,CAAC;AACDe,QAAAA,SAAS,EAAEA,SADV;AAEDE,QAAAA,SAAS,EAAEA,SAFV;AAGDZ,QAAAA,MAAM,EAAEA,MAHP;AAIDe,QAAAA,aAAa,EAAEA,aAJd;AAKDE,QAAAA,aAAa,EAAEA,aALd;AAMDE,QAAAA,QAAQ,EAAEA,QAAQ,CAACpB,GAAT,CAAa,UAAUqB,CAAV,EAAa;AAClC,iBAAO,CAAC,GAAGrE,OAAO,CAACH,OAAZ,EAAqB,CAAC,OAAD,EAAU,UAAV,CAArB,EAA4CwE,CAA5C,CAAP;AACD,SAFS,CANT;AASDC,QAAAA,QAAQ,EAAEA,QAAQ,CAACtB,GAAT,CAAa,UAAUuB,CAAV,EAAa;AAClC,iBAAO,CAAC,GAAGvE,OAAO,CAACH,OAAZ,EAAqB,CAAC,OAAD,EAAU,UAAV,CAArB,EAA4C0E,CAA5C,CAAP;AACD,SAFS;AATT,OAAD,CAAF;AAaD,KAvBD;;AAyBA,WAAOrB,CAAP;AACD,GA7BW,CAAZ;AA8BA,SAAO,UAAUsB,OAAV,EAAmB;AACxB,WAAO3B,KAAK,CAACV,OAAN,CAAc,UAAUe,CAAV,EAAa;AAChC,aAAOA,CAAC,CAACuB,KAAF,CAAQ,IAAR,EAAc,yBAAd,EAAyCxC,aAAa,CAAC;AAC5DyC,QAAAA,UAAU,EAAE;AADgD,OAAD,EAE1DF,OAF0D,CAAtD,CAAP;AAGD,KAJM,CAAP;AAKD,GAND;AAOD,CAtCD;;AAwCA,IAAIG,YAAY,GAAG,SAASA,YAAT,CAAsBhC,OAAtB,EAA+BC,EAA/B,EAAmC;AACpD,MAAIC,KAAK,GAAG,CAACC,KAAK,CAACC,OAAN,CAAcJ,OAAd,IAAyBA,OAAzB,GAAmC,CAACA,OAAD,CAApC,EAA+CK,GAA/C,CAAmD,UAAU4B,IAAV,EAAgB;AAC7E,QAAI3B,MAAM,GAAG2B,IAAI,CAAC3B,MAAlB;AAAA,QACI4B,KAAK,GAAGD,IAAI,CAACC,KADjB;AAEA,QAAI3B,CAAC,GAAG,CAAC,GAAG9C,cAAc,CAACP,OAAnB,EAA4B,GAAGsD,MAAH,CAAUV,IAAV,EAAgB,GAAhB,EAAqBU,MAArB,CAA4BF,MAAM,CAACG,WAAP,EAA5B,EAAkD,QAAlD,EAA4DD,MAA5D,CAAmE0B,KAAnE,CAA5B,CAAR;;AAEA3B,IAAAA,CAAC,CAACG,SAAF,GAAc,UAAUC,GAAV,EAAe;AAC3B,UAAIwB,YAAY,GAAGtB,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,IAAf,CAAnB;AAAA,UACIqB,YAAY,GAAGD,YAAY,CAACC,YADhC;AAAA,UAEIC,IAAI,GAAGF,YAAY,CAACE,IAFxB;AAAA,UAGIC,IAAI,GAAGH,YAAY,CAACG,IAHxB;;AAKArC,MAAAA,EAAE,CAAC;AACDK,QAAAA,MAAM,EAAEA,MADP;AAED4B,QAAAA,KAAK,EAAEA,KAFN;AAGDE,QAAAA,YAAY,EAAEA,YAHb;AAIDC,QAAAA,IAAI,EAAEA,IAAI,CAAChC,GAAL,CAAS,UAAUqB,CAAV,EAAa;AAC1B,iBAAO,CAAC,GAAGrE,OAAO,CAACH,OAAZ,EAAqB,CAAC,OAAD,EAAU,UAAV,CAArB,EAA4CwE,CAA5C,CAAP;AACD,SAFK,CAJL;AAODY,QAAAA,IAAI,EAAEA,IAAI,CAACjC,GAAL,CAAS,UAAUuB,CAAV,EAAa;AAC1B,iBAAO,CAAC,GAAGvE,OAAO,CAACH,OAAZ,EAAqB,CAAC,OAAD,EAAU,UAAV,CAArB,EAA4C0E,CAA5C,CAAP;AACD,SAFK;AAPL,OAAD,CAAF;AAWD,KAjBD;;AAmBA,WAAOrB,CAAP;AACD,GAzBW,CAAZ;AA0BA,SAAO,UAAUsB,OAAV,EAAmB;AACxB,WAAO3B,KAAK,CAACV,OAAN,CAAc,UAAUe,CAAV,EAAa;AAChC,aAAOA,CAAC,CAACuB,KAAF,CAAQ,IAAR,EAAc,yBAAd,EAAyCxC,aAAa,CAAC;AAC5DyC,QAAAA,UAAU,EAAE;AADgD,OAAD,EAE1DF,OAF0D,CAAtD,CAAP;AAGD,KAJM,CAAP;AAKD,GAND;AAOD,CAlCD;;AAoCA,IAAIU,OAAO,GAAG,SAASA,OAAT,CAAiBvC,OAAjB,EAA0BwC,QAA1B,EAAoCvC,EAApC,EAAwC;AACpD,MAAI,CAACuC,QAAD,IAAa,CAACvC,EAAlB,EAAsB;AACpB,UAAM,IAAIwC,KAAJ,CAAU,8CAAV,CAAN;AACD;;AAED,MAAIvC,KAAK,GAAG,CAACC,KAAK,CAACC,OAAN,CAAcJ,OAAd,IAAyBA,OAAzB,GAAmC,CAACA,OAAD,CAApC,EAA+CK,GAA/C,CAAmD,UAAUC,MAAV,EAAkB;AAC/E,QAAIC,CAAC,GAAG,CAAC,GAAG9C,cAAc,CAACP,OAAnB,EAA4B,GAAGsD,MAAH,CAAUV,IAAV,EAAgB,GAAhB,EAAqBU,MAArB,CAA4BF,MAAM,CAACG,WAAP,EAA5B,EAAkD,SAAlD,EAA6DD,MAA7D,CAAoEgC,QAApE,CAA5B,CAAR;;AAEAjC,IAAAA,CAAC,CAACG,SAAF,GAAc,UAAUC,GAAV,EAAe;AAC3B,UAAI+B,YAAY,GAAG7B,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,IAAf,CAAnB;AAAA,UACIC,SAAS,GAAG0B,YAAY,CAACzB,CAD7B;AAAA,UAEIC,SAAS,GAAGwB,YAAY,CAACvB,CAF7B;AAAA,UAGIb,MAAM,GAAGoC,YAAY,CAACtB,CAH1B;AAAA,UAIIuB,IAAI,GAAGD,YAAY,CAACE,CAJxB;;AAMA,UAAIC,SAAS,GAAGF,IAAI,CAACG,CAArB;AAAA,UACIC,SAAS,GAAGJ,IAAI,CAACK,CADrB;AAAA,UAEIC,YAAY,GAAGN,IAAI,CAACO,CAFxB;AAAA,UAGIC,WAAW,GAAGR,IAAI,CAACS,CAHvB;AAAA,UAIIC,IAAI,GAAGV,IAAI,CAACW,CAJhB;AAAA,UAKIC,IAAI,GAAGZ,IAAI,CAACa,CALhB;AAAA,UAMIC,GAAG,GAAGd,IAAI,CAACe,CANf;AAAA,UAOI5B,KAAK,GAAGa,IAAI,CAACgB,CAPjB;AAAA,UAQIC,MAAM,GAAGjB,IAAI,CAACkB,CARlB;AAAA,UASIC,MAAM,GAAGnB,IAAI,CAACoB,CATlB;AAAA,UAUIvB,QAAQ,GAAGG,IAAI,CAACzE,CAVpB;AAAA,UAWI8F,OAAO,GAAGrB,IAAI,CAACsB,CAXnB;AAAA,UAYIC,WAAW,GAAGvB,IAAI,CAACwB,CAZvB;AAAA,UAaIC,SAAS,GAAGzB,IAAI,CAAC0B,CAbrB;AAAA,UAcIC,cAAc,GAAG3B,IAAI,CAAC4B,CAd1B;AAeAtE,MAAAA,EAAE,CAAC;AACDe,QAAAA,SAAS,EAAEA,SADV;AAEDE,QAAAA,SAAS,EAAEA,SAFV;AAGDZ,QAAAA,MAAM,EAAEA,MAHP;AAIDuC,QAAAA,SAAS,EAAEA,SAJV;AAKDE,QAAAA,SAAS,EAAEA,SALV;AAMDE,QAAAA,YAAY,EAAEA,YANb;AAODE,QAAAA,WAAW,EAAEA,WAPZ;AAQDE,QAAAA,IAAI,EAAEA,IARL;AASDE,QAAAA,IAAI,EAAEA,IATL;AAUDE,QAAAA,GAAG,EAAEA,GAVJ;AAWD3B,QAAAA,KAAK,EAAEA,KAXN;AAYD8B,QAAAA,MAAM,EAAEA,MAZP;AAaDE,QAAAA,MAAM,EAAEA,MAbP;AAcDtB,QAAAA,QAAQ,EAAEA,QAdT;AAeDwB,QAAAA,OAAO,EAAEA,OAfR;AAgBDE,QAAAA,WAAW,EAAEA,WAhBZ;AAiBDE,QAAAA,SAAS,EAAEA,SAjBV;AAkBDE,QAAAA,cAAc,EAAEA;AAlBf,OAAD,CAAF;AAoBD,KA1CD;;AA4CA,WAAO/D,CAAP;AACD,GAhDW,CAAZ;AAiDA,SAAO,UAAUsB,OAAV,EAAmB;AACxB,WAAO3B,KAAK,CAACV,OAAN,CAAc,UAAUe,CAAV,EAAa;AAChC,aAAOA,CAAC,CAACuB,KAAF,CAAQ,IAAR,EAAc,yBAAd,EAAyCxC,aAAa,CAAC;AAC5DyC,QAAAA,UAAU,EAAE;AADgD,OAAD,EAE1DF,OAF0D,CAAtD,CAAP;AAGD,KAJM,CAAP;AAKD,GAND;AAOD,CA7DD;;AA+DA,IAAI2C,eAAe,GAAG,SAASA,eAAT,CAAyBC,CAAzB,EAA4B;AAChD,SAAO;AACLzD,IAAAA,SAAS,EAAEyD,CAAC,CAACxD,CADR;AAELC,IAAAA,SAAS,EAAEuD,CAAC,CAACtD,CAFR;AAGLb,IAAAA,MAAM,EAAEmE,CAAC,CAACrD,CAHL;AAILsD,IAAAA,WAAW,EAAED,CAAC,CAACE,CAJV;AAKLC,IAAAA,kBAAkB,EAAEH,CAAC,CAACI,CALjB;AAMLC,IAAAA,WAAW,EAAEL,CAAC,CAAClE,CANV;AAOLwE,IAAAA,YAAY,EAAEN,CAAC,CAACR,CAPX;AAQLe,IAAAA,WAAW,EAAEP,CAAC,CAACd,CARV;AASLsB,IAAAA,kBAAkB,EAAER,CAAC,CAACF,CATjB;AAULW,IAAAA,OAAO,EAAET,CAAC,CAAC/C,CAVN;AAWLyD,IAAAA,UAAU,EAAEV,CAAC,CAACW,CAXT;AAYLC,IAAAA,OAAO,EAAEZ,CAAC,CAAC7C,CAZN;AAaL0D,IAAAA,UAAU,EAAEb,CAAC,CAACc,CAbT;AAcLlC,IAAAA,IAAI,EAAEoB,CAAC,CAACnB,CAdH;AAeLC,IAAAA,IAAI,EAAEkB,CAAC,CAACjB,CAfH;AAgBLC,IAAAA,GAAG,EAAEgB,CAAC,CAACf,CAhBF;AAiBLE,IAAAA,MAAM,EAAEa,CAAC,CAACZ,CAjBL;AAkBL2B,IAAAA,WAAW,EAAEf,CAAC,CAACN,CAlBV;AAmBLsB,IAAAA,QAAQ,EAAEhB,CAAC,CAACiB,CAnBP;AAoBL3C,IAAAA,SAAS,EAAE0B,CAAC,CAACkB,CApBR;AAqBL1C,IAAAA,YAAY,EAAEwB,CAAC,CAACmB,CArBX;AAsBLzC,IAAAA,WAAW,EAAEsB,CAAC,CAACrB,CAtBV;AAuBLyC,IAAAA,WAAW,EAAEpB,CAAC,CAACV;AAvBV,GAAP;AAyBD,CA1BD;;AA4BA,IAAI+B,MAAM,GAAG,SAASA,MAAT,CAAgB9F,OAAhB,EAAyBC,EAAzB,EAA6B;AACxC,MAAIC,KAAK,GAAG,CAACC,KAAK,CAACC,OAAN,CAAcJ,OAAd,IAAyBA,OAAzB,GAAmC,CAACA,OAAD,CAApC,EAA+CK,GAA/C,CAAmD,UAAUC,MAAV,EAAkB;AAC/E,QAAIC,CAAC,GAAG,CAAC,GAAG9C,cAAc,CAACP,OAAnB,EAA4B,GAAGsD,MAAH,CAAUV,IAAV,EAAgB,GAAhB,EAAqBU,MAArB,CAA4BF,MAAM,CAACG,WAAP,EAA5B,EAAkD,SAAlD,CAA5B,CAAR;;AAEAF,IAAAA,CAAC,CAACG,SAAF,GAAc,UAAUC,GAAV,EAAe;AAC3BV,MAAAA,EAAE,CAACuE,eAAe,CAAC3D,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,IAAf,CAAD,CAAhB,CAAF;AACD,KAFD;;AAIA,WAAOR,CAAP;AACD,GARW,CAAZ;AASA,SAAO,UAAUsB,OAAV,EAAmB;AACxB,WAAO3B,KAAK,CAACV,OAAN,CAAc,UAAUe,CAAV,EAAa;AAChC,aAAOA,CAAC,CAACuB,KAAF,CAAQ,IAAR,EAAc,yBAAd,EAAyCxC,aAAa,CAAC;AAC5DyC,QAAAA,UAAU,EAAE;AADgD,OAAD,EAE1DF,OAF0D,CAAtD,CAAP;AAGD,KAJM,CAAP;AAKD,GAND;AAOD,CAjBD;;AAmBA,IAAIkE,UAAU,GAAG,SAASA,UAAT,CAAoB9F,EAApB,EAAwB;AACvC,MAAIM,CAAC,GAAG,IAAI9C,cAAc,CAACP,OAAnB,CAA2B,GAAGsD,MAAH,CAAUV,IAAV,EAAgB,cAAhB,CAA3B,CAAR;;AAEAS,EAAAA,CAAC,CAACG,SAAF,GAAc,UAAUC,GAAV,EAAe;AAC3B,QAAIqF,GAAG,GAAGnF,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,IAAf,CAAV;AACAd,IAAAA,EAAE,CAAC+F,GAAG,CAAC3F,GAAJ,CAAQ,UAAUoE,CAAV,EAAa;AACtB,aAAOD,eAAe,CAACC,CAAD,CAAtB;AACD,KAFE,CAAD,CAAF;AAGD,GALD;;AAOA,SAAO,UAAU5C,OAAV,EAAmB;AACxB,WAAOtB,CAAC,CAACuB,KAAF,CAAQ,IAAR,EAAc,yBAAd,EAAyCxC,aAAa,CAAC;AAC5DyC,MAAAA,UAAU,EAAE;AADgD,KAAD,EAE1DF,OAF0D,CAAtD,CAAP;AAGD,GAJD;AAKD,CAfD;;AAiBA,IAAIoE,cAAc,GAAG,SAASA,cAAT,CAAwBjG,OAAxB,EAAiCkG,UAAjC,EAA6CjG,EAA7C,EAAiD;AACpE,MAAIC,KAAK,GAAG,CAACC,KAAK,CAACC,OAAN,CAAcJ,OAAd,IAAyBA,OAAzB,GAAmC,CAACA,OAAD,CAApC,EAA+CK,GAA/C,CAAmD,UAAUC,MAAV,EAAkB;AAC/E,QAAIC,CAAC,GAAG,CAAC,GAAG9C,cAAc,CAACP,OAAnB,EAA4B,GAAGsD,MAAH,CAAUV,IAAV,EAAgB,GAAhB,EAAqBU,MAArB,CAA4BF,MAAM,CAACG,WAAP,EAA5B,EAAkD,GAAlD,EAAuDD,MAAvD,CAA8D0F,UAA9D,CAA5B,CAAR;;AAEA3F,IAAAA,CAAC,CAACG,SAAF,GAAc,UAAUC,GAAV,EAAe;AAC3B,UAAIwF,YAAY,GAAGtF,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,IAAf,CAAnB;AAAA,UACIC,SAAS,GAAGmF,YAAY,CAAClF,CAD7B;AAAA,UAEIC,SAAS,GAAGiF,YAAY,CAAChF,CAF7B;AAAA,UAGIb,MAAM,GAAG6F,YAAY,CAAC/E,CAH1B;AAAA,UAIIgF,KAAK,GAAGD,YAAY,CAACxB,CAJzB;AAAA,UAKI0B,QAAQ,GAAGF,YAAY,CAAChC,CAL5B;AAAA,UAMImC,KAAK,GAAGH,YAAY,CAAC1B,CANzB;AAAA,UAOI8B,YAAY,GAAGJ,YAAY,CAACK,CAPhC;AAAA,UAQIC,OAAO,GAAGN,YAAY,CAACvE,CAR3B;;AAUA3B,MAAAA,EAAE,CAAC;AACDe,QAAAA,SAAS,EAAEA,SADV;AAEDE,QAAAA,SAAS,EAAEA,SAFV;AAGDZ,QAAAA,MAAM,EAAEA,MAHP;AAID8F,QAAAA,KAAK,EAAEA,KAJN;AAKDC,QAAAA,QAAQ,EAAEA,QALT;AAMDC,QAAAA,KAAK,EAAEA,KANN;AAODC,QAAAA,YAAY,EAAEA,YAPb;AAQDE,QAAAA,OAAO,EAAEA;AARR,OAAD,CAAF;AAUD,KArBD;;AAuBA,WAAOlG,CAAP;AACD,GA3BW,CAAZ;AA4BA,SAAO,UAAUsB,OAAV,EAAmB;AACxB,WAAO3B,KAAK,CAACV,OAAN,CAAc,UAAUe,CAAV,EAAa;AAChC,aAAOA,CAAC,CAACuB,KAAF,CAAQ,IAAR,EAAc,yBAAd,EAAyCxC,aAAa,CAAC;AAC5DyC,QAAAA,UAAU,EAAE;AADgD,OAAD,EAE1DF,OAF0D,CAAtD,CAAP;AAGD,KAJM,CAAP;AAKD,GAND;AAOD,CApCD;;AAsCA,IAAI6E,SAAS,GAAG,SAASA,SAAT,CAAmB1G,OAAnB,EAA4BC,EAA5B,EAAgC;AAC9C,SAAOgG,cAAc,CAACjG,OAAD,EAAU,UAAV,EAAsBC,EAAtB,CAArB;AACD,CAFD;;AAIA,IAAI6D,MAAM,GAAG,SAASA,MAAT,CAAgB9D,OAAhB,EAAyBC,EAAzB,EAA6B;AACxC,SAAOgG,cAAc,CAACjG,OAAD,EAAU,OAAV,EAAmBC,EAAnB,CAArB;AACD,CAFD;;AAIA,IAAI0G,cAAc,GAAG;AACnBC,EAAAA,mBAAmB,EAAE,SAASA,mBAAT,CAA6BnC,CAA7B,EAAgC;AACnD,WAAO;AACLzD,MAAAA,SAAS,EAAE,SADN;AAELE,MAAAA,SAAS,EAAEuD,CAAC,CAACtD,CAFR;AAGL0F,MAAAA,mBAAmB,EAAEpC,CAAC,CAACA,CAHlB;AAILqC,MAAAA,mBAAmB,EAAErC,CAAC,CAAC3B,CAJlB;AAKLiE,MAAAA,mBAAmB,EAAEtC,CAAC,CAAC/C,CALlB;AAMLsF,MAAAA,oBAAoB,EAAEvC,CAAC,CAACrD,CANnB;AAOL6F,MAAAA,QAAQ,EAAExC,CAAC,CAACzB,CAPP;AAQLkE,MAAAA,WAAW,EAAEzC,CAAC,CAAC0C,CARV;AASLC,MAAAA,UAAU,EAAE3C,CAAC,CAAC4C,CATT;AAULC,MAAAA,iBAAiB,EAAE7C,CAAC,CAACjD,CAVhB;AAWL+F,MAAAA,QAAQ,EAAE9C,CAAC,CAACW,CAAF,CAAIoC,MAAJ,CAAW,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AACvCD,QAAAA,GAAG,CAACC,GAAG,CAAC9F,CAAL,CAAH,GAAa;AACX+F,UAAAA,SAAS,EAAED,GAAG,CAACxE,CADJ;AAEX0E,UAAAA,MAAM,EAAEF,GAAG,CAAChE;AAFD,SAAb;AAIA,eAAO+D,GAAP;AACD,OANS,EAMP,EANO;AAXL,KAAP;AAmBD,GArBkB;AAsBnBI,EAAAA,eAAe,EAAE,SAASA,eAAT,CAAyBpD,CAAzB,EAA4B;AAC3C,WAAO;AACLzD,MAAAA,SAAS,EAAE,iBADN;AAELE,MAAAA,SAAS,EAAEuD,CAAC,CAACtD,CAFR;AAGLb,MAAAA,MAAM,EAAEmE,CAAC,CAACrD,CAHL;AAIL0G,MAAAA,gBAAgB,EAAErD,CAAC,CAACd,CAJf;AAKLoE,MAAAA,qBAAqB,EAAEtD,CAAC,CAACkB,CALpB;AAMLqC,MAAAA,IAAI,EAAEvD,CAAC,CAACwD,CANH;AAOLC,MAAAA,SAAS,EAAEzD,CAAC,CAACnB,CAPR;AAQL6E,MAAAA,WAAW,EAAE1D,CAAC,CAACvB,CARV;AASLmD,MAAAA,QAAQ,EAAE5B,CAAC,CAACN,CATP;AAULiC,MAAAA,KAAK,EAAE3B,CAAC,CAACE,CAVJ;AAWLyD,MAAAA,aAAa,EAAE3D,CAAC,CAACR,CAXZ;AAYLoE,MAAAA,SAAS,EAAE5D,CAAC,CAACI,CAZR;AAaLyD,MAAAA,eAAe,EAAE7D,CAAC,CAACmB,CAbd;AAcL2C,MAAAA,WAAW,EAAE9D,CAAC,CAAC+D,CAdV;AAeLC,MAAAA,iBAAiB,EAAEhE,CAAC,CAACiE,CAfhB;AAgBLC,MAAAA,OAAO,EAAElE,CAAC,CAACvG,CAhBN;AAiBL0K,MAAAA,SAAS,EAAEnE,CAAC,CAACzB,CAjBR;AAkBL6F,MAAAA,iBAAiB,EAAEpE,CAAC,CAACf,CAlBhB;AAmBLoF,MAAAA,kBAAkB,EAAErE,CAAC,CAACsE,CAnBjB;AAoBLC,MAAAA,cAAc,EAAEvE,CAAC,CAACrB,CApBb;AAqBL6F,MAAAA,UAAU,EAAExE,CAAC,CAACV,CArBT;AAsBLmF,MAAAA,eAAe,EAAEzE,CAAC,CAAC0E,CAtBd;AAuBL1C,MAAAA,OAAO,EAAEhC,CAAC,CAAC3B,CAvBN;AAwBLsG,MAAAA,cAAc,EAAE3E,CAAC,CAAClE,CAxBb;AAyBLgG,MAAAA,YAAY,EAAE9B,CAAC,CAACA,CAzBX;AA0BL4E,MAAAA,YAAY,EAAE5E,CAAC,CAACiB,CA1BX;AA2BL4D,MAAAA,uBAAuB,EAAE7E,CAAC,CAAC8E;AA3BtB,KAAP;AA6BD;AApDkB,CAArB;;AAuDA,IAAInM,gBAAgB,GAAG,SAASA,gBAAT,CAA0B6C,EAA1B,EAA8B;AACnD,SAAO,UAAUU,GAAV,EAAe;AACpB,QAAI6I,YAAY,GAAG3I,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,IAAf,CAAnB;AAAA,QACI0I,IAAI,GAAGD,YAAY,CAACvI,CADxB;AAAA,QAEIyI,IAAI,GAAG9L,wBAAwB,CAAC4L,YAAD,EAAe,CAAC,GAAD,CAAf,CAFnC;;AAIAvJ,IAAAA,EAAE,CAAC0G,cAAc,CAAC8C,IAAD,CAAd,GAAuB9C,cAAc,CAAC8C,IAAD,CAAd,CAAqBC,IAArB,CAAvB,GAAoDpK,aAAa,CAAC;AACnEmK,MAAAA,IAAI,EAAEA;AAD6D,KAAD,EAEjEC,IAFiE,CAAlE,CAAF;AAGD,GARD;AASD,CAVD;;AAYA1M,OAAO,CAACI,gBAAR,GAA2BA,gBAA3B;;AAEA,IAAID,eAAe,GAAG,SAASA,eAAT,CAAyBwM,MAAzB,EAAiCC,SAAjC,EAA4C;AAChE,SAAOD,MAAM,CAAC;AACZC,IAAAA,SAAS,EAAEA;AADC,GAAD,CAAb;AAGD,CAJD;;AAMA5M,OAAO,CAACG,eAAR,GAA0BA,eAA1B;;AAEA,IAAI0M,IAAI,GAAG,SAASA,IAAT,CAAcC,IAAd,EAAoBC,MAApB,EAA4B;AACrC,SAAO,UAAU9J,EAAV,EAAc;AACnB,QAAI+J,OAAO,GAAG,CAAC,GAAGxM,WAAW,CAACN,OAAhB,EAAyB4M,IAAzB,CAAd;AACA,QAAIG,aAAa,GAAGF,MAAM,GAAGC,OAAO,CAACE,mBAAX,GAAiCF,OAAO,CAACC,aAAnE;AACA,QAAIE,cAAc,GAAGJ,MAAM,GAAGC,OAAO,CAACI,oBAAX,GAAkCJ,OAAO,CAACG,cAArE;AACA,QAAIE,eAAe,GAAGN,MAAM,GAAGC,OAAO,CAACM,qBAAX,GAAmCN,OAAO,CAACK,eAAvE;AACA,QAAIE,gBAAgB,GAAG,IAAvB;AACA,QAAIC,GAAG,GAAG,IAAV;AACA,QAAIjK,CAAC,GAAG,IAAR;;AAEA,QAAIkK,SAAS,GAAG,SAASA,SAAT,CAAmBC,cAAnB,EAAmC;AACjD,UAAIH,gBAAJ,EAAsB;AACpBpN,QAAAA,eAAe,CAACgN,cAAD,EAAiBI,gBAAjB,CAAf,CAAkDI,KAAlD,CAAwD,YAAY;AAClEC,UAAAA,WAAW,CAAC,EAAD,EAAK,IAAL,CAAX;;AAEA,cAAIF,cAAJ,EAAoB;AAClBG,YAAAA,UAAU,CAAC,YAAY;AACrB,qBAAOC,UAAU,CAAC,IAAD,CAAjB;AACD,aAFS,EAEP,IAFO,CAAV;AAGD,WAJD,MAIO;AACLA,YAAAA,UAAU,CAAC,IAAD,CAAV;AACD;AACF,SAVD;AAWD;AACF,KAdD;;AAgBA,QAAIF,WAAW,GAAG,SAASA,WAAT,CAAqB/I,OAArB,EAA8BkJ,WAA9B,EAA2C;AAC3D,UAAIR,gBAAJ,EAAsB;AACpBS,QAAAA,aAAa,CAACR,GAAD,CAAb;AACA,YAAI7F,CAAC,GAAG0F,eAAe,CAAC;AACtBT,UAAAA,SAAS,EAAEW;AADW,SAAD,CAAvB;;AAIA,YAAIQ,WAAJ,EAAiB;AACfpG,UAAAA,CAAC,CAACgG,KAAF,CAAQ,UAAUzH,CAAV,EAAa;AACnB,mBAAOA,CAAP;AACD,WAFD;AAGD;;AAED3C,QAAAA,CAAC,CAACuB,KAAF,CAAQ,IAAR,EAAc,yBAAd,EAAyCxC,aAAa,CAAC;AACrDyC,UAAAA,UAAU,EAAE;AADyC,SAAD,EAEnDF,OAFmD,CAAtD;AAGA0I,QAAAA,gBAAgB,GAAG,IAAnB;AACD;AACF,KAlBD;;AAoBA,QAAIO,UAAU,GAAG,SAASA,UAAT,CAAoBJ,cAApB,EAAoC;AACnD,aAAOT,aAAa,GAAGgB,IAAhB,CAAqB,UAAUC,KAAV,EAAiB;AAC3C,YAAItB,SAAS,GAAGsB,KAAK,CAACtB,SAAtB;AACArJ,QAAAA,CAAC,GAAG,CAAC,GAAG9C,cAAc,CAACP,OAAnB,EAA4B,GAAGsD,MAAH,CAAUV,IAAV,EAAgB,GAAhB,EAAqBU,MAArB,CAA4BoJ,SAA5B,CAA5B,CAAJ;;AAEArJ,QAAAA,CAAC,CAACG,SAAF,GAAc,UAAUC,GAAV,EAAe;AAC3B,iBAAOvD,gBAAgB,CAAC6C,EAAD,CAAhB,CAAqBU,GAArB,CAAP;AACD,SAFD;;AAIA4J,QAAAA,gBAAgB,GAAGX,SAAnB;AACAY,QAAAA,GAAG,GAAGW,WAAW,CAAC,YAAY;AAC5B,iBAAOV,SAAS,CAAC,KAAD,CAAhB;AACD,SAFgB,EAEd,IAFc,CAAjB;AAGAA,QAAAA,SAAS,CAAC,IAAD,CAAT;AACA,eAAO,UAAU5I,OAAV,EAAmB;AACxB,iBAAO+I,WAAW,CAAC/I,OAAD,CAAlB;AACD,SAFD;AAGD,OAhBM,EAgBJ8I,KAhBI,CAgBE,UAAUS,GAAV,EAAe;AACtB,YAAIV,cAAJ,EAAoB;AAClBG,UAAAA,UAAU,CAAC,YAAY;AACrB,mBAAOC,UAAU,CAAC,IAAD,CAAjB;AACD,WAFS,EAEP,IAFO,CAAV;AAGD,SAJD,MAIO;AACL,gBAAMM,GAAN;AACD;AACF,OAxBM,CAAP;AAyBD,KA1BD;;AA4BA,WAAON,UAAU,CAAC,KAAD,CAAjB;AACD,GA1ED;AA2ED,CA5ED;;AA8EA,IAAIO,QAAQ,GAAG,SAASA,QAAT,CAAkBvB,IAAlB,EAAwB;AACrC,SAAO;AACL/J,IAAAA,KAAK,EAAEA,KADF;AAELiC,IAAAA,YAAY,EAAEA,YAFT;AAGLO,IAAAA,OAAO,EAAEA,OAHJ;AAILuB,IAAAA,MAAM,EAAEA,MAJH;AAKL4C,IAAAA,SAAS,EAAEA,SALN;AAMLZ,IAAAA,MAAM,EAAEA,MANH;AAOLC,IAAAA,UAAU,EAAEA,UAPP;AAQL8D,IAAAA,IAAI,EAAEA,IAAI,CAACC,IAAD,CARL;AASLwB,IAAAA,UAAU,EAAEzB,IAAI,CAACC,IAAD,EAAO,IAAP;AATX,GAAP;AAWD,CAZD;;AAcA9M,OAAO,CAACE,OAAR,GAAkBmO,QAAlB","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.keepStreamAlive = exports.userEventHandler = void 0;\n\nvar _lodash = _interopRequireDefault(require(\"lodash.zipobject\"));\n\nvar _httpClient = _interopRequireDefault(require(\"./http-client\"));\n\nvar _openWebsocket = _interopRequireDefault(require(\"./open-websocket\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar BASE = 'wss://stream.binance.com:9443/ws';\n\nvar depth = function depth(payload, cb) {\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (symbol) {\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@depth\"));\n\n    w.onmessage = function (msg) {\n      var _JSON$parse = JSON.parse(msg.data),\n          eventType = _JSON$parse.e,\n          eventTime = _JSON$parse.E,\n          symbol = _JSON$parse.s,\n          firstUpdateId = _JSON$parse.U,\n          finalUpdateId = _JSON$parse.u,\n          bidDepth = _JSON$parse.b,\n          askDepth = _JSON$parse.a;\n\n      cb({\n        eventType: eventType,\n        eventTime: eventTime,\n        symbol: symbol,\n        firstUpdateId: firstUpdateId,\n        finalUpdateId: finalUpdateId,\n        bidDepth: bidDepth.map(function (b) {\n          return (0, _lodash.default)(['price', 'quantity'], b);\n        }),\n        askDepth: askDepth.map(function (a) {\n          return (0, _lodash.default)(['price', 'quantity'], a);\n        })\n      });\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar partialDepth = function partialDepth(payload, cb) {\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (_ref) {\n    var symbol = _ref.symbol,\n        level = _ref.level;\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@depth\").concat(level));\n\n    w.onmessage = function (msg) {\n      var _JSON$parse2 = JSON.parse(msg.data),\n          lastUpdateId = _JSON$parse2.lastUpdateId,\n          bids = _JSON$parse2.bids,\n          asks = _JSON$parse2.asks;\n\n      cb({\n        symbol: symbol,\n        level: level,\n        lastUpdateId: lastUpdateId,\n        bids: bids.map(function (b) {\n          return (0, _lodash.default)(['price', 'quantity'], b);\n        }),\n        asks: asks.map(function (a) {\n          return (0, _lodash.default)(['price', 'quantity'], a);\n        })\n      });\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar candles = function candles(payload, interval, cb) {\n  if (!interval || !cb) {\n    throw new Error('Please pass a symbol, interval and callback.');\n  }\n\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (symbol) {\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@kline_\").concat(interval));\n\n    w.onmessage = function (msg) {\n      var _JSON$parse3 = JSON.parse(msg.data),\n          eventType = _JSON$parse3.e,\n          eventTime = _JSON$parse3.E,\n          symbol = _JSON$parse3.s,\n          tick = _JSON$parse3.k;\n\n      var startTime = tick.t,\n          closeTime = tick.T,\n          firstTradeId = tick.f,\n          lastTradeId = tick.L,\n          open = tick.o,\n          high = tick.h,\n          low = tick.l,\n          close = tick.c,\n          volume = tick.v,\n          trades = tick.n,\n          interval = tick.i,\n          isFinal = tick.x,\n          quoteVolume = tick.q,\n          buyVolume = tick.V,\n          quoteBuyVolume = tick.Q;\n      cb({\n        eventType: eventType,\n        eventTime: eventTime,\n        symbol: symbol,\n        startTime: startTime,\n        closeTime: closeTime,\n        firstTradeId: firstTradeId,\n        lastTradeId: lastTradeId,\n        open: open,\n        high: high,\n        low: low,\n        close: close,\n        volume: volume,\n        trades: trades,\n        interval: interval,\n        isFinal: isFinal,\n        quoteVolume: quoteVolume,\n        buyVolume: buyVolume,\n        quoteBuyVolume: quoteBuyVolume\n      });\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar tickerTransform = function tickerTransform(m) {\n  return {\n    eventType: m.e,\n    eventTime: m.E,\n    symbol: m.s,\n    priceChange: m.p,\n    priceChangePercent: m.P,\n    weightedAvg: m.w,\n    prevDayClose: m.x,\n    curDayClose: m.c,\n    closeTradeQuantity: m.Q,\n    bestBid: m.b,\n    bestBidQnt: m.B,\n    bestAsk: m.a,\n    bestAskQnt: m.A,\n    open: m.o,\n    high: m.h,\n    low: m.l,\n    volume: m.v,\n    volumeQuote: m.q,\n    openTime: m.O,\n    closeTime: m.C,\n    firstTradeId: m.F,\n    lastTradeId: m.L,\n    totalTrades: m.n\n  };\n};\n\nvar ticker = function ticker(payload, cb) {\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (symbol) {\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@ticker\"));\n\n    w.onmessage = function (msg) {\n      cb(tickerTransform(JSON.parse(msg.data)));\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar allTickers = function allTickers(cb) {\n  var w = new _openWebsocket.default(\"\".concat(BASE, \"/!ticker@arr\"));\n\n  w.onmessage = function (msg) {\n    var arr = JSON.parse(msg.data);\n    cb(arr.map(function (m) {\n      return tickerTransform(m);\n    }));\n  };\n\n  return function (options) {\n    return w.close(1000, 'Close handle was called', _objectSpread({\n      keepClosed: true\n    }, options));\n  };\n};\n\nvar tradesInternal = function tradesInternal(payload, streamName, cb) {\n  var cache = (Array.isArray(payload) ? payload : [payload]).map(function (symbol) {\n    var w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(symbol.toLowerCase(), \"@\").concat(streamName));\n\n    w.onmessage = function (msg) {\n      var _JSON$parse4 = JSON.parse(msg.data),\n          eventType = _JSON$parse4.e,\n          eventTime = _JSON$parse4.E,\n          symbol = _JSON$parse4.s,\n          price = _JSON$parse4.p,\n          quantity = _JSON$parse4.q,\n          maker = _JSON$parse4.m,\n          isBuyerMaker = _JSON$parse4.M,\n          tradeId = _JSON$parse4.a;\n\n      cb({\n        eventType: eventType,\n        eventTime: eventTime,\n        symbol: symbol,\n        price: price,\n        quantity: quantity,\n        maker: maker,\n        isBuyerMaker: isBuyerMaker,\n        tradeId: tradeId\n      });\n    };\n\n    return w;\n  });\n  return function (options) {\n    return cache.forEach(function (w) {\n      return w.close(1000, 'Close handle was called', _objectSpread({\n        keepClosed: true\n      }, options));\n    });\n  };\n};\n\nvar aggTrades = function aggTrades(payload, cb) {\n  return tradesInternal(payload, 'aggTrade', cb);\n};\n\nvar trades = function trades(payload, cb) {\n  return tradesInternal(payload, 'trade', cb);\n};\n\nvar userTransforms = {\n  outboundAccountInfo: function outboundAccountInfo(m) {\n    return {\n      eventType: 'account',\n      eventTime: m.E,\n      makerCommissionRate: m.m,\n      takerCommissionRate: m.t,\n      buyerCommissionRate: m.b,\n      sellerCommissionRate: m.s,\n      canTrade: m.T,\n      canWithdraw: m.W,\n      canDeposit: m.D,\n      lastAccountUpdate: m.u,\n      balances: m.B.reduce(function (out, cur) {\n        out[cur.a] = {\n          available: cur.f,\n          locked: cur.l\n        };\n        return out;\n      }, {})\n    };\n  },\n  executionReport: function executionReport(m) {\n    return {\n      eventType: 'executionReport',\n      eventTime: m.E,\n      symbol: m.s,\n      newClientOrderId: m.c,\n      originalClientOrderId: m.C,\n      side: m.S,\n      orderType: m.o,\n      timeInForce: m.f,\n      quantity: m.q,\n      price: m.p,\n      executionType: m.x,\n      stopPrice: m.P,\n      icebergQuantity: m.F,\n      orderStatus: m.X,\n      orderRejectReason: m.r,\n      orderId: m.i,\n      orderTime: m.T,\n      lastTradeQuantity: m.l,\n      totalTradeQuantity: m.z,\n      priceLastTrade: m.L,\n      commission: m.n,\n      commissionAsset: m.N,\n      tradeId: m.t,\n      isOrderWorking: m.w,\n      isBuyerMaker: m.m,\n      creationTime: m.O,\n      totalQuoteTradeQuantity: m.Z\n    };\n  }\n};\n\nvar userEventHandler = function userEventHandler(cb) {\n  return function (msg) {\n    var _JSON$parse5 = JSON.parse(msg.data),\n        type = _JSON$parse5.e,\n        rest = _objectWithoutProperties(_JSON$parse5, [\"e\"]);\n\n    cb(userTransforms[type] ? userTransforms[type](rest) : _objectSpread({\n      type: type\n    }, rest));\n  };\n};\n\nexports.userEventHandler = userEventHandler;\n\nvar keepStreamAlive = function keepStreamAlive(method, listenKey) {\n  return method({\n    listenKey: listenKey\n  });\n};\n\nexports.keepStreamAlive = keepStreamAlive;\n\nvar user = function user(opts, margin) {\n  return function (cb) {\n    var methods = (0, _httpClient.default)(opts);\n    var getDataStream = margin ? methods.marginGetDataStream : methods.getDataStream;\n    var keepDataStream = margin ? methods.marginKeepDataStream : methods.keepDataStream;\n    var closeDataStream = margin ? methods.marginCloseDataStream : methods.closeDataStream;\n    var currentListenKey = null;\n    var int = null;\n    var w = null;\n\n    var keepAlive = function keepAlive(isReconnecting) {\n      if (currentListenKey) {\n        keepStreamAlive(keepDataStream, currentListenKey).catch(function () {\n          closeStream({}, true);\n\n          if (isReconnecting) {\n            setTimeout(function () {\n              return makeStream(true);\n            }, 30e3);\n          } else {\n            makeStream(true);\n          }\n        });\n      }\n    };\n\n    var closeStream = function closeStream(options, catchErrors) {\n      if (currentListenKey) {\n        clearInterval(int);\n        var p = closeDataStream({\n          listenKey: currentListenKey\n        });\n\n        if (catchErrors) {\n          p.catch(function (f) {\n            return f;\n          });\n        }\n\n        w.close(1000, 'Close handle was called', _objectSpread({\n          keepClosed: true\n        }, options));\n        currentListenKey = null;\n      }\n    };\n\n    var makeStream = function makeStream(isReconnecting) {\n      return getDataStream().then(function (_ref2) {\n        var listenKey = _ref2.listenKey;\n        w = (0, _openWebsocket.default)(\"\".concat(BASE, \"/\").concat(listenKey));\n\n        w.onmessage = function (msg) {\n          return userEventHandler(cb)(msg);\n        };\n\n        currentListenKey = listenKey;\n        int = setInterval(function () {\n          return keepAlive(false);\n        }, 50e3);\n        keepAlive(true);\n        return function (options) {\n          return closeStream(options);\n        };\n      }).catch(function (err) {\n        if (isReconnecting) {\n          setTimeout(function () {\n            return makeStream(true);\n          }, 30e3);\n        } else {\n          throw err;\n        }\n      });\n    };\n\n    return makeStream(false);\n  };\n};\n\nvar _default = function _default(opts) {\n  return {\n    depth: depth,\n    partialDepth: partialDepth,\n    candles: candles,\n    trades: trades,\n    aggTrades: aggTrades,\n    ticker: ticker,\n    allTickers: allTickers,\n    user: user(opts),\n    marginUser: user(opts, true)\n  };\n};\n\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}